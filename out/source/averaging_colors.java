/* autogenerated by Processing revision 1276 on 2022-06-27 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class averaging_colors extends PApplet {

PGraphics pg;
PGraphics sg;
PImage seed;
IntDict inventory;

String storedColor;
int usableColor;
int starter;
int divider;

int incr = 0;

float col;
float row;

 public void setup() {
    /* size commented out by preprocessor */;
    
    /* pixelDensity commented out by preprocessor */;

    divider = 2;

    col = 0;
    row = 0;

    String url = "https://picsum.photos/"+ width / divider +"/"+height;
    pg = createGraphics(width / divider, height);
    sg = createGraphics(width / divider, height);
    seed = loadImage(url, "jpg");
    inventory = new IntDict();
    starter = 1; 
}

 public void draw() {

    displaySeed();
    displayShapes();
    image(pg, 0,0);
    image(sg, width / divider,0);
    noLoop();
    
}

 public void displaySeed(){
    pg.beginDraw();
    pg.background(255,0,0);
    pg.image(seed, 0, 0);
    pg.endDraw();
}

 public void displayShapes(){

    sg.beginDraw();

    sg.background(255);

    for (int i = 0; i < pg.width; ++i) {
        for (int j = 0; j < pg.height; ++j) {
            int pixelIndex = i + j * width / divider;
            int pixR = pg.pixels[pixelIndex];
            int pixG = pg.pixels[pixelIndex];
            int pixB = pg.pixels[pixelIndex];

            float cR = red(pixR);
            float cG = green(pixG);
            float cB = blue(pixB);

            storedColor = hex(color(cR, cG, cB));

            if (inventory.hasKey(storedColor) == true) {
                inventory.increment(storedColor);
            } else {
                inventory.set(storedColor, starter);
            }
        }
    }

    inventory.sortValuesReverse();
    float amount = 500;
    float neededNbr = 30;
    float w = (width / divider) / neededNbr;
    float h = height / neededNbr;
    
    for (int index = 1; index < amount + 1; index++) {

        usableColor = unhex(inventory.key(index));
        //sg.stroke(usableColor);
        sg.noStroke();
        sg.fill(usableColor);
        sg.rect(col, row, w, h);
    
        col += w;
        
        if(index % neededNbr == 0) {
            row += h;
            col = 0;
            println(w, h);
        }

    }

    sg.endDraw();
}


  public void settings() { size(1024, 512);
pixelDensity(2); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "averaging_colors" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
